DESTDIR = /usr/local
CC = gcc
AR = ar
RANLIB = ranlib
CPPFLAGS = rien
CFLAGS = -O2 -I.
ARFLAGS = cru

LIB_SRC = jcapimin.c jcapistd.c jccoefct.c jccolor.c jcdctmgr.c jchuff.c \
jcinit.c jcmainct.c jcmarker.c jcmaster.c jcomapi.c jcparam.c \
jcphuff.c jcprepct.c jcsample.c jctrans.c jdapimin.c jdapistd.c \
jdatadst.c jdatasrc.c jdcoefct.c jdcolor.c jddctmgr.c jdhuff.c \
jdinput.c jdmainct.c jdmarker.c jdmaster.c jdmerge.c jdphuff.c \
jdpostct.c jdsample.c jdtrans.c jerror.c jfdctflt.c jfdctfst.c \
jfdctint.c jidctflt.c jidctfst.c jidctint.c jidctred.c jquant1.c \
jquant2.c jutils.c jmemmgr.c jmemnobs.c

OBJ = $(LIB_SRC:.c=.o)

CJPEG = cjpeg.c
DJPEG = djpeg.c
JPEGTRAN = jpegtran.c

CJPEG_SRC = cjpeg.c rdppm.c rdgif.c rdtarga.c rdrle.c rdbmp.c rdswitch.c cdjpeg.c libjpeg.a
DJPEG_SRC = djpeg.c wrppm.c wrgif.c wrtarga.c wrrle.c wrbmp.c rdcolmap.c cdjpeg.c libjpeg.a
JPEGTRAN_SRC = jpegtran.c rdswitch.c cdjpeg.c transupp.c libjpeg.a

CMD = cjpeg djpeg jpegtran rdjpgcom wrjpgcom

all: libjpeg.a $(CMD)

jconfig.h: ckconfig.c
	$(CC) $(CFLAGS) $< -o ckconfig
	./ckconfig

libjpeg.a: $(OBJ)
	$(AR) $(ARFLAGS) $@ $(OBJ)
	$(RANLIB) $@

%.o: %.c jconfig.h $(CJPEG) $(DJPEG) $(JPEGTRAN)
	$(CC) -c $(CFLAGS) $< -o $@

cjpeg: $(CJPEG_SRC)
	$(CC) -c $(CFLAGS) $< -o $@

djpeg: $(DJPEG_SRC)
	$(CC) -c $(CFLAGS) $< -o $@

jpegtran: $(JPEGTRAN_SRC)
	$(CC) -c $(CFLAGS) $< -o $@

rdjpgcom: rdjpgcom.c
	$(CC) -c $(CFLAGS) $< -o $@

wrjpgcom: wrjpgcom.c
	$(CC) -c $(CFLAGS) $< -o $@


depend: $(LIB_SRC) $(CJPEG) $(DJPEG) $(JPEGTRAN)
	$(CC) -MM $(LIB_SRC) $(CJPEG) $(DJPEG) $(JPEGTRAN) > .depend

-include .depend

install:
	mkdir -p $(DESTDIR)/src && cp libjpeg.a $(DESTDIR)/src

clean:
	rm -f $(OBJ) libjpeg.a $(CMD) ckconfig .depend 

.PHONY: all depend clean

